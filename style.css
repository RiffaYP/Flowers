const startBtn = document.getElementById("startBtn");
const overlay = document.getElementById("startOverlay");
const flower = document.getElementById("flower");
const popup = document.getElementById("popup");
const closePopup = document.getElementById("closePopup");
const again = document.getElementById("again");
const petalContainer = document.getElementById("petalContainer");

// Generate petals for 3D flower
function buildFlower(){
  const total = 12;
  for(let i=0;i<total;i++){
    const p = document.createElement("div");
    p.className="petal";
    const angle = (360/total)*i;
    p.style.transform = `translate(-50%,-50%) rotate(${angle}deg)`;
    flower.appendChild(p);
  }
}

// Falling petals
function spawnFallingPetals(num=18){
  for(let i=0;i<num;i++){
    const p = document.createElement("div");
    p.className="fall";
    p.style.left = Math.random()*100 + "vw";
    p.style.animationDuration = 4 + Math.random()*4 + "s";
    petalContainer.appendChild(p);
    setTimeout(()=>p.remove(),6000);
  }
}

function start(){
  overlay.style.display="none";

  // Animate flower bloom
  flower.style.opacity="1";
  flower.style.transform="scale(1) rotateX(0deg)";

  // falling petals loop
  spawnFallingPetals(20);
  let fallLoop = setInterval(()=> spawnFallingPetals(10), 2500);

  // popup muncul
  setTimeout(()=> popup.classList.remove("hidden"), 1800);

  // stop petal loop after 20s
  setTimeout(()=> clearInterval(fallLoop), 20000);
}

startBtn.onclick = start;

// Popup buttons
closePopup.onclick = ()=> popup.classList.add("hidden");
again.onclick = ()=> {
  popup.classList.add("hidden");
  spawnFallingPetals(20);
  flower.style.transform="scale(1.1)";
  setTimeout(()=> flower.style.transform="scale(1)", 300);
};

// build flower on load
buildFlower();
